import { useGSAP } from "@gsap/react";
import gsap from "gsap";
import React, { useRef } from "react";

const UndiscoveredMap = () => {
	const containerRef = useRef(null);
	const timelineRef = useRef(null);

	useGSAP(
		() => {
			const mapPins = containerRef.current?.querySelectorAll("#map-pin");
			const questionMarks =
				containerRef.current?.querySelectorAll("#question-mark");

			if (mapPins && mapPins.length > 0) {
				// สร้าง master timeline
				timelineRef.current = gsap.timeline();

				// ตั้งค่าเริ่มต้น
				gsap.set(mapPins, {
					scale: 0,
					opacity: 0,
					transformOrigin: "center bottom",
				});

				if (questionMarks) {
					gsap.set(questionMarks, {
						scale: 0.5,
						opacity: 0,
					});
				}

				// Animation sequence
				timelineRef.current
					// Question mark ขึ้นก่อน
					.to(questionMarks, {
						scale: 1,
						opacity: 1,
						duration: 0.6,
						ease: "back.out(1.7)",
					})
					// ตามด้วย pins ขึ้นทีละอัน
					.to(
						mapPins,
						{
							scale: 1,
							opacity: 1,
							duration: 0.5,
							stagger: {
								each: 0.15, // แต่ละ pin ห่างกัน 0.15 วินาที
								from: "random", // หรือใช้ "start", "center", "edges", "random"
							},
							ease: "back.out(1.7)",
						},
						"-=0.2" // เริ่มก่อน animation ก่อนหน้าจะจบ 0.2 วินาที
					)
					.to(
						questionMarks,
						{
							y: 10,
							repeat: -1,
							yoyo: true,
							duration: 2,
							ease: "sine.inOut",
						},
						"-=0.5"
					);
			}

			// Cleanup function
			return () => {
				if (timelineRef.current) {
					timelineRef.current.kill();
				}
			};
		},
		{ scope: containerRef }
	);

	return (
		<div ref={containerRef} className="w-full h-full">
			<svg
				width="422"
				height="241"
				viewBox="0 0 422 241"
				fill="none"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path
					opacity="0.2"
					d="M78.7535 115.998L126.439 123.72L204.358 112.976L262.45 128.404L321.049 115.331L375.377 219.244L287.821 239.905L203.801 231.246L105.601 240.504L43.7021 215.817L78.7535 115.998Z"
					fill="black"
				/>
				<path
					d="M65.2664 73.4431L117.864 81.959L203.826 70.1093L267.902 87.1243L332.544 72.7003L392.485 187.341L295.898 210.129L203.21 200.575L94.8824 210.787L26.6028 183.56L65.2664 73.4431Z"
					fill="white"
					stroke="black"
					strokeLinecap="round"
					strokeLinejoin="round"
				/>
				<path
					d="M75.2679 80.8449L116.354 88.2468L203.353 77.1482L269.244 92.6947L326.257 79.7393L375.133 183.155L292.665 203.664L203.809 195.139L95.6251 202.643L43.947 179.728L75.2679 80.8449Z"
					fill="#AEB2CC"
					stroke="black"
					strokeLinecap="round"
					strokeLinejoin="round"
				/>
				<g opacity="0.64">
					<path
						d="M309.284 126.581L277.431 134.92H267.742C267.742 134.92 280.208 146.922 304.203 149.226C328.198 151.53 333.743 146.922 333.743 146.922L309.284 126.581Z"
						fill="white"
					/>
					<path
						d="M170.817 84.5839L149.582 89.2005L146.814 96.5855L160.2 93.8172L156.967 110.427L172.665 108.587L175.434 89.6563L170.817 84.5839Z"
						fill="white"
					/>
					<path
						d="M157.431 113.195L156.047 121.509L165.28 119.66V112.74L157.431 113.195Z"
						fill="white"
					/>
					<path
						d="M151.895 113.195L150.046 122.429L132.044 124.741L132.508 118.276L151.895 113.195Z"
						fill="white"
					/>
					<path
						d="M258.264 154.281C249.469 154.281 242.338 158.822 242.338 164.409C242.338 169.997 249.469 174.537 258.264 174.537C267.058 174.537 274.19 169.988 274.19 164.409C274.19 158.831 267.075 154.281 258.264 154.281ZM258.264 169.043C254.263 169.043 251.022 166.984 251.022 164.435C251.022 161.886 254.263 159.818 258.264 159.818C262.264 159.818 265.522 161.928 265.522 164.46C265.522 166.992 262.281 169.043 258.264 169.043Z"
						fill="white"
					/>
					<path
						d="M132.044 190.742L144.51 160.274L116.818 161.666L112.657 172.275H125.579L115.89 194.43L132.044 190.742Z"
						fill="white"
					/>
					<path
						d="M185.587 124.277L204.045 120.125L228.049 127.51L209.582 130.734L204.51 126.581L185.587 130.278V124.277Z"
						fill="white"
					/>
					<path
						d="M186.507 106.739L186.971 118.741L195.276 116.892L193.892 106.275L186.507 106.739Z"
						fill="white"
					/>
					<path
						d="M71.5796 113.195L64.1946 134.43L94.1988 142.28L98.8155 125.661L85.8938 113.66L71.5796 113.195Z"
						fill="white"
					/>
				</g>
				<path
					d="M368.828 169.803L356.885 157.987C358.945 157.725 360.937 157.438 362.844 157.143L361.35 153.969C358.962 154.324 356.455 154.661 353.839 154.965L318.239 119.728C327.7 118.319 336.688 117.103 343.559 116.394L342.031 113.17C334.604 113.963 325.151 115.272 315.411 116.74L315.512 116.124L314.373 115.947L301.823 103.523L330.004 87.5969L328.561 84.5417L299.358 101.05L286.867 88.6941L282.968 89.5381L308.735 115.027L226.783 102.207C226.386 101.303 225.989 100.4 225.626 99.472C223.283 93.5231 221.465 87.3807 220.191 81.115L216.562 80.271C217.895 87.2199 219.873 94.0294 222.47 100.611L222.875 101.599L203.674 98.5858L183.857 100.316L183.148 79.7224L179.772 80.1529L181.62 136.49C180.472 136.49 179.325 136.49 178.244 136.439C147.059 135.536 113.374 126.438 108.386 123.72C105.01 121.855 97.4144 113.069 93.3717 108.081C101.634 107.65 109.627 106.536 114.354 104.08C120.835 100.704 136.171 91.8001 149.346 84.0353L140.838 85.124C129.588 91.7157 118.152 98.3157 112.809 101.084C103.246 106.047 77.6395 105.017 67.8069 104.409L66.7519 107.735C70.4149 107.98 76.8124 108.317 83.902 108.317C85.59 108.317 87.4046 108.317 89.1854 108.25C90.4514 109.853 101.55 123.83 106.774 126.683C111.999 129.535 145.911 138.878 178.151 139.807C179.339 139.841 180.546 139.857 181.772 139.857L182.025 147.563L156.224 148.314L155.836 148.179L155.785 148.323L104.538 149.817L57.2231 137.832L56.2019 141.056L85.3452 148.424L58.3372 186.092L61.4938 187.484L88.89 149.319L104.2 153.193L154.612 151.724L139.935 193.156L122.692 200.752L132.635 200.068L203.801 168.739L254.584 141.537C260.364 145.391 266.601 148.509 273.152 150.821C279.095 152.905 285.165 154.61 291.323 155.927L283.879 170.824L253.2 199.908L257.656 200.33L286.42 173.069L286.631 172.866L294.75 156.628C303.297 158.248 311.952 159.241 320.644 159.599L313.808 198.423L317.395 197.536L324.096 159.691C325.86 159.734 327.607 159.767 329.337 159.767C337.111 159.759 344.878 159.334 352.606 158.493L373.056 178.749L368.828 169.803ZM144.172 191.308L158.199 151.64L182.135 150.956L182.903 174.276L144.172 191.308ZM306.524 118.15C286.943 121.239 268.248 124.581 264.18 125.391L260.804 126.075C257.192 126.826 251.563 127.999 244.726 129.282C237.988 122.475 232.47 114.562 228.412 105.886L306.524 118.15ZM183.992 103.692L203.531 102.004L224.411 105.279C228.489 114.384 234.054 122.747 240.878 130.025C229.399 132.109 215.22 134.355 201.404 135.578L201.26 135.367L200.872 135.629C195.47 136.093 190.136 136.405 185.039 136.473L183.992 103.692ZM185.174 139.815C188.448 139.765 191.824 139.613 195.242 139.393L185.385 146.044L185.174 139.815ZM202.408 165.658L186.254 172.765L185.511 150.036L202.054 138.87C216.84 137.536 231.973 135.072 243.806 132.878C246.235 135.197 248.809 137.359 251.512 139.351L202.408 165.658ZM274.3 147.58C264.537 144.215 255.532 138.961 247.798 132.118C253.58 131.012 258.331 130.025 261.522 129.358L264.839 128.674C270.865 127.467 293.028 123.61 314.069 120.361L349.517 155.412C328.206 157.463 300.861 156.965 274.3 147.58Z"
					fill="white"
					stroke="black"
					strokeLinecap="round"
					strokeLinejoin="round"
				/>
				<path
					d="M100.664 173.584L95.2537 205.234"
					stroke="black"
					strokeLinecap="round"
					strokeLinejoin="round"
				/>
				<path
					d="M115.619 86.0271L101.761 167.152"
					stroke="black"
					strokeLinecap="round"
					strokeLinejoin="round"
				/>
				<path
					d="M203.125 73.5021L203.59 106.275"
					stroke="black"
					strokeLinecap="round"
					strokeLinejoin="round"
				/>
				<path
					d="M271.422 112.385L290.361 192.126"
					stroke="black"
					strokeLinecap="round"
					strokeLinejoin="round"
				/>
				<path
					d="M266.358 91.0405L270.519 108.579"
					stroke="black"
					strokeLinecap="round"
					strokeLinejoin="round"
				/>
				<path
					d="M204.045 198.127L203.59 178.74"
					stroke="black"
					strokeLinecap="round"
					strokeLinejoin="round"
				/>
				<path
					d="M87.0165 105.101C85.9862 105.101 84.9659 105.305 84.0141 105.699C83.0622 106.094 82.1975 106.672 81.4693 107.401C80.7411 108.13 80.1637 108.995 79.7702 109.948C79.3767 110.9 79.1747 111.92 79.1758 112.951C79.1758 117.28 87.0165 125.357 87.0165 125.357C87.0165 125.357 94.8657 117.28 94.8657 112.951C94.8657 110.869 94.0388 108.872 92.5668 107.4C91.0948 105.928 89.0983 105.101 87.0165 105.101ZM87.0165 116.073C86.4904 116.073 85.976 115.917 85.5386 115.625C85.1012 115.332 84.7605 114.917 84.5595 114.43C84.3586 113.944 84.3064 113.409 84.4097 112.893C84.5129 112.377 84.767 111.903 85.1396 111.532C85.5123 111.16 85.9868 110.908 86.5031 110.806C87.0193 110.705 87.5542 110.759 88.0398 110.961C88.5255 111.164 88.9401 111.506 89.2312 111.944C89.5223 112.382 89.6768 112.897 89.6751 113.423C89.6707 114.125 89.3886 114.797 88.8905 115.292C88.3924 115.787 87.7187 116.065 87.0165 116.065V116.073Z"
					fill="#7800D2"
					stroke="#7800D2"
					strokeLinecap="round"
					strokeLinejoin="round"
					id="map-pin"
				/>
				<path
					d="M168.463 68.8094C167.432 68.8094 166.412 69.0125 165.46 69.4071C164.508 69.8017 163.644 70.38 162.915 71.1089C162.187 71.8379 161.61 72.7033 161.216 73.6555C160.823 74.6078 160.621 75.6283 160.622 76.6587C160.622 80.9884 168.463 89.0654 168.463 89.0654C168.463 89.0654 176.312 80.9884 176.312 76.6587C176.312 74.5769 175.485 72.5804 174.013 71.1084C172.541 69.6364 170.544 68.8094 168.463 68.8094ZM168.463 79.7814C167.936 79.7814 167.422 79.6253 166.985 79.3328C166.547 79.0403 166.207 78.6246 166.006 78.1383C165.805 77.652 165.752 77.117 165.856 76.6011C165.959 76.0851 166.213 75.6114 166.586 75.24C166.958 74.8685 167.433 74.6159 167.949 74.5143C168.465 74.4127 169 74.4665 169.486 74.6691C169.971 74.8716 170.386 75.2136 170.677 75.652C170.968 76.0903 171.123 76.6051 171.121 77.1313C171.117 77.8335 170.835 78.5054 170.337 79.0003C169.838 79.4952 169.165 79.773 168.463 79.773V79.7814Z"
					fill="#7800D2"
					stroke="#7800D2"
					strokeLinecap="round"
					strokeLinejoin="round"
					id="map-pin"
				/>
				<path
					d="M312.584 119.019C311.554 119.018 310.533 119.22 309.581 119.613C308.629 120.007 307.763 120.584 307.034 121.313C306.305 122.041 305.727 122.905 305.333 123.857C304.938 124.809 304.735 125.829 304.735 126.86C304.735 131.198 312.584 139.267 312.584 139.267C312.584 139.267 320.425 131.198 320.425 126.86C320.425 124.78 319.599 122.786 318.128 121.316C316.658 119.845 314.664 119.019 312.584 119.019ZM312.584 129.991C312.061 129.991 311.549 129.836 311.113 129.546C310.678 129.255 310.338 128.842 310.137 128.359C309.936 127.876 309.883 127.344 309.984 126.83C310.085 126.316 310.335 125.844 310.704 125.473C311.073 125.102 311.544 124.848 312.057 124.744C312.57 124.64 313.102 124.69 313.587 124.888C314.071 125.086 314.486 125.423 314.779 125.856C315.073 126.29 315.231 126.801 315.234 127.324C315.234 128.027 314.955 128.701 314.458 129.198C313.961 129.695 313.287 129.974 312.584 129.974V129.991Z"
					fill="#7800D2"
					stroke="#7800D2"
					strokeLinecap="round"
					strokeLinejoin="round"
					id="map-pin"
				/>
				<path
					d="M255.614 75.975C254.584 75.9739 253.563 76.1759 252.611 76.5694C251.659 76.963 250.793 77.5403 250.064 78.2685C249.335 78.9967 248.757 79.8615 248.363 80.8133C247.968 81.7651 247.765 82.7854 247.765 83.8158C247.765 88.1539 255.614 96.2226 255.614 96.2226C255.614 96.2226 263.455 88.1539 263.455 83.8158C263.455 81.7363 262.629 79.7419 261.158 78.2715C259.688 76.8011 257.694 75.975 255.614 75.975ZM255.614 86.947C255.091 86.947 254.579 86.792 254.144 86.5015C253.708 86.2111 253.368 85.7981 253.167 85.3149C252.966 84.8316 252.913 84.2996 253.014 83.786C253.115 83.2724 253.365 82.8002 253.734 82.4289C254.103 82.0576 254.574 81.8038 255.087 81.6997C255.6 81.5955 256.132 81.6456 256.617 81.8436C257.101 82.0416 257.516 82.3787 257.809 82.8122C258.103 83.2458 258.261 83.7565 258.264 84.28C258.264 84.9828 257.985 85.6569 257.488 86.1539C256.991 86.6509 256.317 86.9301 255.614 86.9301V86.947Z"
					fill="#7800D2"
					stroke="#7800D2"
					strokeLinecap="round"
					strokeLinejoin="round"
					id="map-pin"
				/>
				<path
					d="M210.5 176.312C247.227 176.312 277 160.12 277 140.147C277 120.174 247.227 103.983 210.5 103.983C173.773 103.983 144 120.174 144 140.147C144 160.12 173.773 176.312 210.5 176.312Z"
					fill="#F5F5F5"
					fillOpacity="0.5"
				/>
				<path
					d="M204.34 105.48C204.34 100.52 205.15 96.0635 206.77 92.11C208.391 88.1565 211.732 84.7124 216.796 81.7777C218.317 80.8663 220.191 79.833 222.419 78.6777C224.712 77.4738 226.897 76.0757 228.951 74.4989C231.051 72.9111 232.873 70.9869 234.345 68.8042C235.829 66.5792 236.598 63.9543 236.549 61.2805C236.593 59.3331 236.179 57.4026 235.34 55.6447C234.566 54.0754 233.481 52.68 232.15 51.5434C230.784 50.4046 229.202 49.5518 227.5 49.0355C225.755 48.4847 223.936 48.2035 222.106 48.2016C220.032 48.1732 217.973 48.5568 216.049 49.33C214.278 50.0595 212.617 51.0308 211.114 52.2161C209.648 53.3765 208.321 54.7028 207.161 56.1686C206.093 57.501 205.104 58.8953 204.201 60.3443H201.913L190.979 51.2303C192.244 48.1656 194.016 45.3359 196.221 42.8603C198.377 40.4465 200.886 38.372 203.661 36.7068C206.484 35.0282 209.531 33.7571 212.71 32.931C215.983 32.0666 219.354 31.6321 222.739 31.6383C226.598 31.6405 230.437 32.2033 234.134 33.3092C237.821 34.3944 241.256 36.2027 244.237 38.6288C247.317 41.178 249.806 44.366 251.531 47.9722C253.404 51.7707 254.34 56.304 254.34 61.5719C254.387 64.4737 254.003 67.3664 253.202 70.1558C252.475 72.5686 251.371 74.8515 249.932 76.92C248.506 78.9535 246.821 80.7919 244.919 82.3884C242.854 84.109 240.67 85.6825 238.384 87.0973C236.357 88.3166 234.331 89.4822 232.308 90.5941C230.35 91.6624 228.494 92.9076 226.762 94.3141C225.132 95.6355 223.743 97.2298 222.658 99.0261C221.596 100.799 221.065 102.952 221.065 105.483L204.34 105.48ZM204.65 140.879V119.914H221.514V140.879H204.65Z"
					fill="url(#paint0_linear_222_5628)"
					id="question-mark"
				/>
				<g opacity="0.2">
					<path
						d="M204.34 105.48C204.34 100.52 205.15 96.0635 206.77 92.11C208.391 88.1565 211.732 84.7124 216.796 81.7777C218.317 80.8663 220.191 79.833 222.419 78.6777C224.712 77.4738 226.897 76.0757 228.951 74.4989C231.051 72.9111 232.873 70.9869 234.345 68.8042C235.829 66.5792 236.598 63.9543 236.549 61.2805C236.593 59.3331 236.179 57.4026 235.34 55.6447C234.566 54.0754 233.481 52.68 232.15 51.5434C230.784 50.4046 229.202 49.5518 227.5 49.0355C225.755 48.4847 223.936 48.2035 222.106 48.2016C220.032 48.1732 217.973 48.5568 216.049 49.33C214.278 50.0595 212.617 51.0308 211.114 52.2161C209.648 53.3765 208.321 54.7028 207.161 56.1686C206.093 57.501 205.104 58.8953 204.201 60.3443H201.913L190.979 51.2303C192.244 48.1656 194.016 45.3359 196.221 42.8603C198.377 40.4465 200.886 38.372 203.661 36.7068C206.484 35.0282 209.531 33.7571 212.71 32.931C215.983 32.0666 219.354 31.6321 222.739 31.6383C226.598 31.6405 230.437 32.2033 234.134 33.3092C237.821 34.3944 241.256 36.2027 244.237 38.6288C247.317 41.178 249.806 44.366 251.531 47.9722C253.404 51.7707 254.34 56.304 254.34 61.5719C254.387 64.4737 254.003 67.3664 253.202 70.1558C252.475 72.5686 251.371 74.8515 249.932 76.92C248.506 78.9535 246.821 80.7919 244.919 82.3884C242.854 84.109 240.67 85.6825 238.384 87.0973C236.357 88.3166 234.331 89.4822 232.308 90.5941C230.35 91.6624 228.494 92.9076 226.762 94.3141C225.132 95.6355 223.743 97.2298 222.658 99.0261C221.596 100.799 221.065 102.952 221.065 105.483L204.34 105.48ZM204.65 140.879V119.914H221.514V140.879H204.65Z"
						fill="black"
						id="question-mark"
					/>
				</g>
				<path
					d="M202.065 105.48C202.065 100.52 202.875 96.0635 204.495 92.11C206.115 88.1565 209.458 84.7124 214.524 81.7777C216.043 80.8663 217.916 79.833 220.144 78.6777C222.438 77.4745 224.624 76.0764 226.679 74.4989C228.778 72.9103 230.6 70.9862 232.073 68.8042C233.554 66.5783 234.322 63.9538 234.274 61.2805C234.314 59.3378 233.897 57.4128 233.058 55.6602C232.284 54.0909 231.199 52.6955 229.869 51.5589C228.502 50.4201 226.921 49.5673 225.219 49.051C223.473 48.5002 221.654 48.219 219.825 48.2171C217.751 48.1827 215.69 48.561 213.764 49.33C211.993 50.0597 210.331 51.0309 208.826 52.2161C207.361 53.3766 206.036 54.7029 204.876 56.1686C203.807 57.501 202.818 58.8953 201.913 60.3443L188.694 51.2303C189.958 48.1651 191.73 45.3353 193.936 42.8603C196.092 40.4456 198.6 38.3709 201.376 36.7068C204.199 35.0287 207.244 33.7576 210.422 32.931C213.698 32.0655 217.072 31.631 220.46 31.6383C224.319 31.6402 228.158 32.2031 231.856 33.3092C235.543 34.3937 238.978 36.2021 241.959 38.6288C245.039 41.1773 247.528 44.3655 249.253 47.9722C251.125 51.7707 252.062 56.304 252.065 61.5719C252.11 64.4738 251.726 67.3666 250.924 70.1558C250.195 72.5696 249.088 74.8526 247.644 76.92C246.219 78.9535 244.533 80.7919 242.631 82.3884C240.567 84.1105 238.383 85.684 236.096 87.0973C234.073 88.3166 232.048 89.4822 230.02 90.5941C228.062 91.6624 226.206 92.9076 224.475 94.3141C222.845 95.6356 221.457 97.2299 220.373 99.0261C219.311 100.799 218.779 102.952 218.777 105.483L202.065 105.48ZM202.375 140.879V119.914H219.22V140.879H202.375Z"
					fill="url(#paint1_linear_222_5628)"
					id="question-mark"
				/>
				<defs>
					<linearGradient
						id="paint0_linear_222_5628"
						x1="190.979"
						y1="86.2587"
						x2="254.344"
						y2="86.2587"
						gradientUnits="userSpaceOnUse"
					>
						<stop stopColor="#E6007D" />
						<stop offset="1" stopColor="#7800D2" />
					</linearGradient>
					<linearGradient
						id="paint1_linear_222_5628"
						x1="188.694"
						y1="86.2587"
						x2="252.068"
						y2="86.2587"
						gradientUnits="userSpaceOnUse"
					>
						<stop stopColor="#E6007D" />
						<stop offset="1" stopColor="#7800D2" />
					</linearGradient>
				</defs>
			</svg>
		</div>
	);
};

export default UndiscoveredMap;
